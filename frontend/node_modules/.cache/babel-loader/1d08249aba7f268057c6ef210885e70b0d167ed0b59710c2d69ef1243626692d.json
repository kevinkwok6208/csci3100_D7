{"ast":null,"code":"var _jsxFileName = \"/Users/kachonlai/Desktop/uni_proj/CSCI3100_Project_Demo/csci3100_D7/frontend/src/components/Reservations.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport './Reservations.css';\nimport StepIndicator from './StepIndicator';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Reservations = ({\n  username: propUsername\n}) => {\n  _s();\n  var _location$state;\n  const location = useLocation();\n  const navigate = useNavigate();\n  const [cartItems, setCartItems] = useState(((_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.cartItems) || []);\n  const [username, setUsername] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [checkoutError, setCheckoutError] = useState(null);\n  const [timeLeft, setTimeLeft] = useState(null);\n  const [timerId, setTimerId] = useState(null);\n  const apiBaseUrl = 'http://localhost:5001'; // Hardcoded for simplicity\n\n  // Add shipping information state\n  const [shippingInfo, setShippingInfo] = useState({\n    name: '',\n    address: '',\n    city: '',\n    state: '',\n    zipCode: '',\n    country: 'USA'\n  });\n\n  // Calculate total with correct calculation using quantity\n  const totalPrice = cartItems.reduce((total, item) => total + item.productPrice, 0).toFixed(2);\n\n  // Set up username and cart items on component mount\n  useEffect(() => {\n    var _location$state2;\n    // First priority: Use username from props if available\n    if (propUsername) {\n      console.log('Username from props:', propUsername);\n      setUsername(propUsername);\n    }\n    // Second priority: Try from location state\n    else if ((_location$state2 = location.state) !== null && _location$state2 !== void 0 && _location$state2.username) {\n      console.log('Username from location state:', location.state.username);\n      setUsername(location.state.username);\n    }\n    // Third priority: Try from localStorage directly\n    else if (localStorage.getItem('username')) {\n      const storedUsername = localStorage.getItem('username');\n      console.log('Username from localStorage:', storedUsername);\n      setUsername(storedUsername);\n    }\n    // If all else fails, use a fallback for development\n    else {\n      console.warn('No username found in props or storage');\n\n      // FALLBACK: If we're in development mode, use a dummy username for testing\n      if (process.env.NODE_ENV === 'development') {\n        const dummyUsername = 'testuser';\n        console.log('Using dummy username for development:', dummyUsername);\n        setUsername(dummyUsername);\n      }\n    }\n\n    // If cartItems is empty and we have items in localStorage, use those\n    if (cartItems.length === 0) {\n      try {\n        const storedCart = JSON.parse(localStorage.getItem('cart') || '[]');\n        if (storedCart.length > 0) {\n          console.log('Using cart from localStorage:', storedCart);\n          setCartItems(storedCart);\n        }\n      } catch (error) {\n        console.error('Error parsing cart from localStorage:', error);\n      }\n    }\n  }, [propUsername, location.state]);\n\n  // Function to start the countdown timer (15 minutes = 900 seconds)\n  const startCheckoutTimer = () => {\n    let secondsLeft = 15 * 60;\n    setTimeLeft(secondsLeft);\n    const timer = setInterval(() => {\n      secondsLeft -= 1;\n      setTimeLeft(secondsLeft);\n      if (secondsLeft <= 0) {\n        clearInterval(timer);\n        removeReservation();\n        alert('Checkout time expired. Your reservation has been released.');\n        navigate('/cart');\n      }\n    }, 1000);\n    setTimerId(timer);\n    return timer;\n  };\n\n  // Function to clear the timer\n  const clearCheckoutTimer = () => {\n    if (timerId) {\n      clearInterval(timerId);\n      setTimerId(null);\n      setTimeLeft(null);\n    }\n  };\n\n  // Format time as MM:SS\n  const formatTime = seconds => {\n    if (seconds === null) return '';\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Remove reservation if user cancels or timeout\n  const removeReservation = async () => {\n    if (!username) {\n      console.error('Cannot remove reservation: No username available');\n      return;\n    }\n    try {\n      console.log(`Removing reservation for user: ${username}`);\n      await axios.post(`${apiBaseUrl}/api/checkout/remove-reservation/${username}`);\n    } catch (error) {\n      console.error('Failed to remove reservation:', error);\n    }\n  };\n\n  // Helper function to simplify cart items for API\n  const prepareCartItemsForAPI = items => {\n    return items.map(item => {\n      // Create a simplified version of the item\n      return {\n        productId: typeof item.productId === 'object' ? item.productId._id : item.productId,\n        productName: typeof item.productId === 'object' ? item.productId.productName : item.productName,\n        productPrice: Number(item.productPrice) || 0,\n        quantity: Number(item.quantity) || 1\n      };\n    });\n  };\n\n  // Handle shipping form input changes\n  const handleShippingInfoChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setShippingInfo(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  // Validate shipping form\n  const validateShippingInfo = () => {\n    const {\n      name,\n      address,\n      city,\n      state,\n      zipCode\n    } = shippingInfo;\n    if (!name.trim()) return 'Name is required';\n    if (!address.trim()) return 'Address is required';\n    return null;\n  };\n  const handleCheckout = async () => {\n    // Use the username state which was set from props\n    let checkoutUsername = username;\n    if (!checkoutUsername) {\n      // Prompt the user for their username as a last resort\n      const promptedUsername = prompt('Please enter your username to continue with checkout:');\n      if (promptedUsername && promptedUsername.trim()) {\n        checkoutUsername = promptedUsername.trim();\n        setUsername(checkoutUsername);\n        console.log('Using prompted username:', checkoutUsername);\n      } else {\n        setCheckoutError('No username available. Please log in first.');\n        return;\n      }\n    }\n    if (cartItems.length === 0) {\n      alert('Your cart is empty');\n      return;\n    }\n\n    // Validate shipping information\n    const shippingError = validateShippingInfo();\n    if (shippingError) {\n      setCheckoutError(shippingError);\n      return;\n    }\n    setIsProcessing(true);\n    setCheckoutError(null);\n    try {\n      // Log what we're sending to help debug\n      console.log('Using username for checkout:', checkoutUsername);\n      console.log('Cart items before preparation:', cartItems);\n\n      // Prepare simplified cart items for API\n      const simplifiedCartItems = prepareCartItemsForAPI(cartItems);\n      console.log('Simplified cart items for API:', simplifiedCartItems);\n\n      // Step 1: Initiate checkout to create reservation\n      console.log(`Sending request to: ${apiBaseUrl}/api/checkout/initiate-checkout/${checkoutUsername}`);\n      const initiateResponse = await axios.post(`${apiBaseUrl}/api/checkout/initiate-checkout/${checkoutUsername}`, {\n        items: simplifiedCartItems,\n        totalAmount: parseFloat(totalPrice)\n      });\n      console.log('Initiate checkout response:', initiateResponse.data);\n      if (initiateResponse.data.success) {\n        // Start the 15-minute countdown\n        startCheckoutTimer();\n\n        // Step 2: Create PayPal order with the shipping info from form\n        const formattedShippingInfo = {\n          name: shippingInfo.name,\n          address: shippingInfo.address\n        };\n        console.log('Creating PayPal order with:', {\n          username: checkoutUsername,\n          shippingInfo: formattedShippingInfo\n        });\n        const createOrderResponse = await axios.post(`${apiBaseUrl}/api/checkout/create-paypal-order`, {\n          username: checkoutUsername,\n          shippingInfo: formattedShippingInfo\n        });\n        console.log('Create PayPal order response:', createOrderResponse.data);\n        if (createOrderResponse.data.success) {\n          // Get the PayPal order ID from the response\n          const orderId = createOrderResponse.data.paypalOrderId;\n          if (orderId) {\n            // Determine the PayPal URL\n            let paypalUrl;\n            if (createOrderResponse.data.approvalUrl) {\n              paypalUrl = createOrderResponse.data.approvalUrl;\n            } else {\n              paypalUrl = `https://www.sandbox.paypal.com/checkoutnow?token=${orderId}`;\n            }\n\n            // Open PayPal in a new window instead of redirecting\n            const paypalWindow = window.open(paypalUrl, 'paypal_window', 'width=1000,height=800,status=yes,scrollbars=yes,resizable=yes');\n\n            // If popup is blocked, provide a fallback\n            if (!paypalWindow || paypalWindow.closed || typeof paypalWindow.closed === 'undefined') {\n              setCheckoutError('Popup blocked! Please allow popups, refresh and try again!');\n              // Create a clickable link as fallback\n              const linkElement = document.createElement('a');\n              linkElement.href = paypalUrl;\n              linkElement.target = '_blank';\n              linkElement.textContent = 'Open PayPal in a new window';\n              linkElement.className = 'paypal-fallback-link';\n              const errorDiv = document.querySelector('.error-message');\n              if (errorDiv) {\n                errorDiv.appendChild(document.createElement('br'));\n                errorDiv.appendChild(linkElement);\n              }\n            } else {\n              // Set up polling to check when the PayPal window is closed  **TASK: can I have a automatically close the paypal window after the payment in paypal is done?\n              const pollTimer = setInterval(() => {\n                if (paypalWindow.closed) {\n                  clearInterval(pollTimer);\n\n                  // When PayPal window is closed, check if payment was completed\n                  // We'll do this by attempting to process the payment\n                  processPayment(checkoutUsername, orderId);\n                }\n              }, 1000);\n\n              // Also set a timeout to stop polling after 15 minutes (same as reservation timeout)\n              setTimeout(() => {\n                clearInterval(pollTimer);\n                if (!paypalWindow.closed) {\n                  paypalWindow.close();\n                }\n                setCheckoutError('Payment session timed out. Please try again.');\n                setIsProcessing(false);\n              }, 15 * 60 * 1000); // 15 minutes\n            }\n          } else {\n            throw new Error('No PayPal order ID returned from server');\n          }\n        } else {\n          throw new Error(createOrderResponse.data.message || 'Failed to create PayPal order');\n        }\n      } else {\n        throw new Error(initiateResponse.data.message || 'Failed to initiate checkout');\n      }\n    } catch (error) {\n      console.error('Checkout error:', error);\n\n      // Provide a more detailed error message\n      let errorMessage = 'An error occurred during checkout';\n      if (error.response) {\n        var _error$response$data;\n        console.error('Error response data:', error.response.data);\n        errorMessage = `Server error: ${error.response.status} - ${((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message}`;\n      } else if (error.request) {\n        errorMessage = 'No response received from server. Please check your connection.';\n      } else {\n        errorMessage = `Error: ${error.message}`;\n      }\n      setCheckoutError(errorMessage);\n      clearCheckoutTimer();\n      setIsProcessing(false);\n    }\n  };\n\n  // Function to process payment after PayPal window is closed\n  const processPayment = async (checkoutUsername, orderId) => {\n    try {\n      setIsProcessing(true);\n      console.log('Processing payment for:', checkoutUsername, 'with PayPal order ID:', orderId);\n      const processResponse = await axios.post(`${apiBaseUrl}/api/checkout/process-payment`, {\n        username: checkoutUsername,\n        paypalOrderId: orderId\n      });\n      console.log('Process payment response:', processResponse.data);\n      if (processResponse.data.success) {\n        // Payment successfully processed\n        clearCheckoutTimer(); // Clear the reservation timer\n\n        // Clear the cart in localStorage and state\n        localStorage.removeItem('cart');\n        setCartItems([]);\n\n        // Show success message\n        alert('Payment successful! Thank you for your order.');\n\n        // Redirect to order confirmation page\n        setTimeout(() => {\n          navigate('/CheckoutFinish', {\n            state: {\n              orderId: processResponse.data.orderId,\n              orderDetails: processResponse.data.orderDetails // Pass the complete order details\n              // Include any other necessary data\n            },\n            search: `?token=${processResponse.data.orderId}` // Add the token as a query parameter\n          });\n        }, 2000); // Short delay to show success message\n      } else {\n        throw new Error(processResponse.data.message || 'Failed to process payment');\n      }\n    } catch (error) {\n      console.error('Payment processing error:', error);\n      let errorMessage = 'An error occurred while processing your payment';\n      if (error.response) {\n        var _error$response$data2;\n        errorMessage = `Server error: ${error.response.status} - ${((_error$response$data2 = error.response.data) === null || _error$response$data2 === void 0 ? void 0 : _error$response$data2.message) || error.message}`;\n      } else if (error.request) {\n        errorMessage = 'No response received from server. Please check your connection.';\n      } else {\n        errorMessage = `Error: ${error.message}`;\n      }\n      setCheckoutError(errorMessage);\n\n      // Attempt to clean up reservations on error\n      try {\n        await axios.post(`${apiBaseUrl}/api/checkout/remove-reservation/${checkoutUsername}`);\n      } catch (cleanupError) {\n        console.error('Failed to clean up reservations:', cleanupError);\n      }\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // Clean up timer when component unmounts\n  useEffect(() => {\n    return () => {\n      clearCheckoutTimer();\n    };\n  }, []);\n\n  // Handle cancellation of checkout\n  const handleCancel = () => {\n    if (window.confirm('Are you sure you want to cancel your reservation?')) {\n      removeReservation();\n      clearCheckoutTimer();\n      navigate('/cart');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(StepIndicator, {\n      currentStep: 2\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"reservations-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Your Reservations\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-summary\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Cart Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 9\n        }, this), cartItems.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Your cart is empty\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 11\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"table\", {\n            className: \"cart-table\",\n            children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n              children: /*#__PURE__*/_jsxDEV(\"tr\", {\n                children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Product\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 454,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Price\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 455,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Quantity\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 456,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Subtotal\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 457,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 453,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 452,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n              children: cartItems.map((item, index) => {\n                var _item$productId;\n                const productName = item.productName || ((_item$productId = item.productId) === null || _item$productId === void 0 ? void 0 : _item$productId.productName) || 'Unknown Product';\n                const quantity = Number(item.quantity) || 1;\n                const productPrice = Number(item.productPrice / item.quantity) || 0;\n                const subtotal = productPrice.toFixed(2);\n                return /*#__PURE__*/_jsxDEV(\"tr\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                    children: productName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 469,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: [\"$\", productPrice.toFixed(2)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 470,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: quantity\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 471,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: [\"$\", subtotal]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 472,\n                    columnNumber: 23\n                  }, this)]\n                }, index, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 468,\n                  columnNumber: 21\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 460,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"tfoot\", {\n              children: /*#__PURE__*/_jsxDEV(\"tr\", {\n                children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                  colSpan: \"3\",\n                  className: \"total-label\",\n                  children: \"Total:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 479,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"total-price\",\n                  children: [\"$\", totalPrice]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 480,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 478,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 477,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"shipping-form\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Shipping Information\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 487,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"form-group\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"name\",\n                children: \"Full Name:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 489,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                id: \"name\",\n                name: \"name\",\n                value: shippingInfo.name,\n                onChange: handleShippingInfoChange,\n                required: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 490,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 488,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"form-group\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"address\",\n                children: \"Street Address:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 501,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                id: \"address\",\n                name: \"address\",\n                value: shippingInfo.address,\n                onChange: handleShippingInfoChange,\n                required: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 502,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 500,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 486,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checkout-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"checkout-button\",\n              onClick: handleCheckout,\n              disabled: isProcessing,\n              children: isProcessing ? 'Processing...' : 'Proceed to PayPal'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 515,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"cancel-button\",\n              onClick: handleCancel,\n              disabled: isProcessing,\n              children: \"Cancel Reservation\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 523,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 514,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(Reservations, \"nlyYvYAaWcY8nBCXmZyn5c0hgYQ=\", false, function () {\n  return [useLocation, useNavigate];\n});\n_c = Reservations;\nexport default Reservations;\nvar _c;\n$RefreshReg$(_c, \"Reservations\");","map":{"version":3,"names":["React","useState","useEffect","useLocation","useNavigate","axios","StepIndicator","jsxDEV","_jsxDEV","Fragment","_Fragment","Reservations","username","propUsername","_s","_location$state","location","navigate","cartItems","setCartItems","state","setUsername","isProcessing","setIsProcessing","checkoutError","setCheckoutError","timeLeft","setTimeLeft","timerId","setTimerId","apiBaseUrl","shippingInfo","setShippingInfo","name","address","city","zipCode","country","totalPrice","reduce","total","item","productPrice","toFixed","_location$state2","console","log","localStorage","getItem","storedUsername","warn","process","env","NODE_ENV","dummyUsername","length","storedCart","JSON","parse","error","startCheckoutTimer","secondsLeft","timer","setInterval","clearInterval","removeReservation","alert","clearCheckoutTimer","formatTime","seconds","mins","Math","floor","secs","toString","padStart","post","prepareCartItemsForAPI","items","map","productId","_id","productName","Number","quantity","handleShippingInfoChange","e","value","target","prev","validateShippingInfo","trim","handleCheckout","checkoutUsername","promptedUsername","prompt","shippingError","simplifiedCartItems","initiateResponse","totalAmount","parseFloat","data","success","formattedShippingInfo","createOrderResponse","orderId","paypalOrderId","paypalUrl","approvalUrl","paypalWindow","window","open","closed","linkElement","document","createElement","href","textContent","className","errorDiv","querySelector","appendChild","pollTimer","processPayment","setTimeout","close","Error","message","errorMessage","response","_error$response$data","status","request","processResponse","removeItem","orderDetails","search","_error$response$data2","cleanupError","handleCancel","confirm","children","currentStep","fileName","_jsxFileName","lineNumber","columnNumber","index","_item$productId","subtotal","colSpan","htmlFor","type","id","onChange","required","onClick","disabled","_c","$RefreshReg$"],"sources":["/Users/kachonlai/Desktop/uni_proj/CSCI3100_Project_Demo/csci3100_D7/frontend/src/components/Reservations.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport './Reservations.css';\nimport StepIndicator from './StepIndicator';\n\nconst Reservations = ({ username: propUsername }) => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  \n  const [cartItems, setCartItems] = useState(location.state?.cartItems || []);\n  const [username, setUsername] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [checkoutError, setCheckoutError] = useState(null);\n  const [timeLeft, setTimeLeft] = useState(null);\n  const [timerId, setTimerId] = useState(null);\n  const apiBaseUrl = 'http://localhost:5001'; // Hardcoded for simplicity\n\n  // Add shipping information state\n  const [shippingInfo, setShippingInfo] = useState({\n    name: '',\n    address: '',\n    city: '',\n    state: '',\n    zipCode: '',\n    country: 'USA'\n  });\n\n  // Calculate total with correct calculation using quantity\n  const totalPrice = cartItems.reduce((total, item) => \n    total + (item.productPrice ), 0).toFixed(2);\n\n  // Set up username and cart items on component mount\n  useEffect(() => {\n    // First priority: Use username from props if available\n    if (propUsername) {\n      console.log('Username from props:', propUsername);\n      setUsername(propUsername);\n    }\n    // Second priority: Try from location state\n    else if (location.state?.username) {\n      console.log('Username from location state:', location.state.username);\n      setUsername(location.state.username);\n    } \n    // Third priority: Try from localStorage directly\n    else if (localStorage.getItem('username')) {\n      const storedUsername = localStorage.getItem('username');\n      console.log('Username from localStorage:', storedUsername);\n      setUsername(storedUsername);\n    }\n    // If all else fails, use a fallback for development\n    else {\n      console.warn('No username found in props or storage');\n      \n      // FALLBACK: If we're in development mode, use a dummy username for testing\n      if (process.env.NODE_ENV === 'development') {\n        const dummyUsername = 'testuser';\n        console.log('Using dummy username for development:', dummyUsername);\n        setUsername(dummyUsername);\n      }\n    }\n\n    // If cartItems is empty and we have items in localStorage, use those\n    if (cartItems.length === 0) {\n      try {\n        const storedCart = JSON.parse(localStorage.getItem('cart') || '[]');\n        if (storedCart.length > 0) {\n          console.log('Using cart from localStorage:', storedCart);\n          setCartItems(storedCart);\n        }\n      } catch (error) {\n        console.error('Error parsing cart from localStorage:', error);\n      }\n    }\n  }, [propUsername, location.state]);\n\n  // Function to start the countdown timer (15 minutes = 900 seconds)\n  const startCheckoutTimer = () => {\n    let secondsLeft = 15 * 60;\n    setTimeLeft(secondsLeft);\n    \n    const timer = setInterval(() => {\n      secondsLeft -= 1;\n      setTimeLeft(secondsLeft);\n      \n      if (secondsLeft <= 0) {\n        clearInterval(timer);\n        removeReservation();\n        alert('Checkout time expired. Your reservation has been released.');\n        navigate('/cart');\n      }\n    }, 1000);\n    \n    setTimerId(timer);\n    return timer;\n  };\n\n  // Function to clear the timer\n  const clearCheckoutTimer = () => {\n    if (timerId) {\n      clearInterval(timerId);\n      setTimerId(null);\n      setTimeLeft(null);\n    }\n  };\n\n  // Format time as MM:SS\n  const formatTime = (seconds) => {\n    if (seconds === null) return '';\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Remove reservation if user cancels or timeout\n  const removeReservation = async () => {\n    if (!username) {\n      console.error('Cannot remove reservation: No username available');\n      return;\n    }\n    \n    try {\n      console.log(`Removing reservation for user: ${username}`);\n      await axios.post(`${apiBaseUrl}/api/checkout/remove-reservation/${username}`);\n    } catch (error) {\n      console.error('Failed to remove reservation:', error);\n    }\n  };\n\n  // Helper function to simplify cart items for API\n  const prepareCartItemsForAPI = (items) => {\n    return items.map(item => {\n      // Create a simplified version of the item\n      return {\n        productId: typeof item.productId === 'object' ? item.productId._id : item.productId,\n        productName: typeof item.productId === 'object' ? item.productId.productName : item.productName,\n        productPrice: Number(item.productPrice) || 0,\n        quantity: Number(item.quantity) || 1\n      };\n    });\n  };\n\n  // Handle shipping form input changes\n  const handleShippingInfoChange = (e) => {\n    const { name, value } = e.target;\n    setShippingInfo(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  // Validate shipping form\n  const validateShippingInfo = () => {\n    const { name, address, city, state, zipCode } = shippingInfo;\n    if (!name.trim()) return 'Name is required';\n    if (!address.trim()) return 'Address is required';\n\n    return null;\n  };\n\n  const handleCheckout = async () => {\n    // Use the username state which was set from props\n    let checkoutUsername = username;\n    \n    if (!checkoutUsername) {\n      // Prompt the user for their username as a last resort\n      const promptedUsername = prompt('Please enter your username to continue with checkout:');\n      if (promptedUsername && promptedUsername.trim()) {\n        checkoutUsername = promptedUsername.trim();\n        setUsername(checkoutUsername);\n        console.log('Using prompted username:', checkoutUsername);\n      } else {\n        setCheckoutError('No username available. Please log in first.');\n        return;\n      }\n    }\n\n    if (cartItems.length === 0) {\n      alert('Your cart is empty');\n      return;\n    }\n\n    // Validate shipping information\n    const shippingError = validateShippingInfo();\n    if (shippingError) {\n      setCheckoutError(shippingError);\n      return;\n    }\n\n    setIsProcessing(true);\n    setCheckoutError(null);\n    \n    try {\n      // Log what we're sending to help debug\n      console.log('Using username for checkout:', checkoutUsername);\n      console.log('Cart items before preparation:', cartItems);\n      \n      // Prepare simplified cart items for API\n      const simplifiedCartItems = prepareCartItemsForAPI(cartItems);\n      console.log('Simplified cart items for API:', simplifiedCartItems);\n      \n      // Step 1: Initiate checkout to create reservation\n      console.log(`Sending request to: ${apiBaseUrl}/api/checkout/initiate-checkout/${checkoutUsername}`);\n      \n      const initiateResponse = await axios.post(\n        `${apiBaseUrl}/api/checkout/initiate-checkout/${checkoutUsername}`,\n        { \n          items: simplifiedCartItems,\n          totalAmount: parseFloat(totalPrice)\n        }\n      );\n      \n      console.log('Initiate checkout response:', initiateResponse.data);\n      \n      if (initiateResponse.data.success) {\n        // Start the 15-minute countdown\n        startCheckoutTimer();\n        \n        // Step 2: Create PayPal order with the shipping info from form\n        const formattedShippingInfo = {\n          name: shippingInfo.name,\n          address: shippingInfo.address\n        };\n\n        console.log('Creating PayPal order with:', {\n          username: checkoutUsername,\n          shippingInfo: formattedShippingInfo\n        });\n\n        const createOrderResponse = await axios.post(\n          `${apiBaseUrl}/api/checkout/create-paypal-order`,\n          { \n            username: checkoutUsername, \n            shippingInfo: formattedShippingInfo\n          }\n        );\n        \n        console.log('Create PayPal order response:', createOrderResponse.data);\n        \n        if (createOrderResponse.data.success) {\n          // Get the PayPal order ID from the response\n          const orderId = createOrderResponse.data.paypalOrderId;\n          \n          if (orderId) {\n            // Determine the PayPal URL\n            let paypalUrl;\n            if (createOrderResponse.data.approvalUrl) {\n              paypalUrl = createOrderResponse.data.approvalUrl;\n            } else {\n              paypalUrl = `https://www.sandbox.paypal.com/checkoutnow?token=${orderId}`;\n            }\n            \n            // Open PayPal in a new window instead of redirecting\n            const paypalWindow = window.open(paypalUrl, 'paypal_window', \n              'width=1000,height=800,status=yes,scrollbars=yes,resizable=yes');\n            \n            // If popup is blocked, provide a fallback\n            if (!paypalWindow || paypalWindow.closed || typeof paypalWindow.closed === 'undefined') {\n              setCheckoutError('Popup blocked! Please allow popups, refresh and try again!');\n              // Create a clickable link as fallback\n              const linkElement = document.createElement('a');\n              linkElement.href = paypalUrl;\n              linkElement.target = '_blank';\n              linkElement.textContent = 'Open PayPal in a new window';\n              linkElement.className = 'paypal-fallback-link';\n              \n              const errorDiv = document.querySelector('.error-message');\n              if (errorDiv) {\n                errorDiv.appendChild(document.createElement('br'));\n                errorDiv.appendChild(linkElement);\n              }\n            } else {\n              // Set up polling to check when the PayPal window is closed  **TASK: can I have a automatically close the paypal window after the payment in paypal is done?\n              const pollTimer = setInterval(() => {\n                if (paypalWindow.closed) {\n                  clearInterval(pollTimer);\n                  \n                  // When PayPal window is closed, check if payment was completed\n                  // We'll do this by attempting to process the payment\n                  processPayment(checkoutUsername, orderId);\n                }\n              }, 1000);\n              \n              // Also set a timeout to stop polling after 15 minutes (same as reservation timeout)\n              setTimeout(() => {\n                clearInterval(pollTimer);\n                if (!paypalWindow.closed) {\n                  paypalWindow.close();\n                }\n                setCheckoutError('Payment session timed out. Please try again.');\n                setIsProcessing(false);\n              }, 15 * 60 * 1000); // 15 minutes\n            }\n          } else {\n            throw new Error('No PayPal order ID returned from server');\n          }\n        } else {\n          throw new Error(createOrderResponse.data.message || 'Failed to create PayPal order');\n        }\n      } else {\n        throw new Error(initiateResponse.data.message || 'Failed to initiate checkout');\n      }\n    } catch (error) {\n      console.error('Checkout error:', error);\n      \n      // Provide a more detailed error message\n      let errorMessage = 'An error occurred during checkout';\n      if (error.response) {\n        console.error('Error response data:', error.response.data);\n        errorMessage = `Server error: ${error.response.status} - ${error.response.data?.message || error.message}`;\n      } else if (error.request) {\n        errorMessage = 'No response received from server. Please check your connection.';\n      } else {\n        errorMessage = `Error: ${error.message}`;\n      }\n      \n      setCheckoutError(errorMessage);\n      clearCheckoutTimer();\n      setIsProcessing(false);\n    }\n  };\n\n\n\n  // Function to process payment after PayPal window is closed\n  const processPayment = async (checkoutUsername, orderId) => {\n    try {\n      setIsProcessing(true);\n      \n      console.log('Processing payment for:', checkoutUsername, 'with PayPal order ID:', orderId);\n      \n      const processResponse = await axios.post(\n        `${apiBaseUrl}/api/checkout/process-payment`,\n        { \n          username: checkoutUsername, \n          paypalOrderId: orderId \n        }\n      );\n      \n      console.log('Process payment response:', processResponse.data);\n      \n      if (processResponse.data.success) {\n        // Payment successfully processed\n        clearCheckoutTimer(); // Clear the reservation timer\n        \n        // Clear the cart in localStorage and state\n        localStorage.removeItem('cart');\n        setCartItems([]);\n        \n        // Show success message\n        alert('Payment successful! Thank you for your order.');\n        \n        // Redirect to order confirmation page\n        setTimeout(() => {\n          navigate('/CheckoutFinish', { \n            state: { \n              orderId: processResponse.data.orderId,\n              orderDetails: processResponse.data.orderDetails // Pass the complete order details\n              // Include any other necessary data\n            },\n            search: `?token=${processResponse.data.orderId}` // Add the token as a query parameter\n          });\n        }, 2000); // Short delay to show success message\n      } else {\n        throw new Error(processResponse.data.message || 'Failed to process payment');\n      }\n    } catch (error) {\n      console.error('Payment processing error:', error);\n      \n      let errorMessage = 'An error occurred while processing your payment';\n      if (error.response) {\n        errorMessage = `Server error: ${error.response.status} - ${error.response.data?.message || error.message}`;\n      } else if (error.request) {\n        errorMessage = 'No response received from server. Please check your connection.';\n      } else {\n        errorMessage = `Error: ${error.message}`;\n      }\n      \n      setCheckoutError(errorMessage);\n      \n      // Attempt to clean up reservations on error\n      try {\n        await axios.post(`${apiBaseUrl}/api/checkout/remove-reservation/${checkoutUsername}`);\n      } catch (cleanupError) {\n        console.error('Failed to clean up reservations:', cleanupError);\n      }\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n\n  // Clean up timer when component unmounts\n  useEffect(() => {\n    return () => {\n      clearCheckoutTimer();\n    };\n  }, []);\n\n  // Handle cancellation of checkout\n  const handleCancel = () => {\n    if (window.confirm('Are you sure you want to cancel your reservation?')) {\n      removeReservation();\n      clearCheckoutTimer();\n      navigate('/cart');\n    }\n  };\n\n  return (\n    <>\n      <StepIndicator currentStep={2} />\n      <div className=\"reservations-container\">\n      <h1>Your Reservations</h1>\n      \n      {/* Debug information section - only show in development */}\n      {/* \n      {process.env.NODE_ENV === 'development' && (\n        <div className=\"debug-info\" style={{background: '#f0f0f0', padding: '10px', marginBottom: '20px', fontSize: '12px'}}>\n          <h4>Order Info:</h4>\n          <p>Username: {username || 'Not set'}</p>\n          <p>Product Items: {cartItems.length}</p>\n          \n        </div>\n      )}\n      \n      {!username && (\n        <div className=\"error-message\">\n          Warning: No username found. Please log in to complete checkout.\n        </div>\n      )}\n      \n      {timeLeft && (\n        <div className=\"checkout-timer\">\n          Time remaining: <span className=\"timer\">{formatTime(timeLeft)}</span>\n        </div>\n      )}\n      \n      {checkoutError && (\n        <div className=\"error-message\">\n          {checkoutError}\n        </div>\n      )}\n      */}\n      \n      <div className=\"cart-summary\">\n        <h2>Cart Summary</h2>\n        {cartItems.length === 0 ? (\n          <p>Your cart is empty</p>\n        ) : (\n          <>\n            <table className=\"cart-table\">\n              <thead>\n                <tr>\n                  <th>Product</th>\n                  <th>Price</th>\n                  <th>Quantity</th>\n                  <th>Subtotal</th>\n                </tr>\n              </thead>\n              <tbody>\n                {cartItems.map((item, index) => {\n                  const productName = item.productName || (item.productId?.productName || 'Unknown Product');\n                  const quantity = Number(item.quantity) || 1;\n                  const productPrice = Number(item.productPrice/item.quantity) || 0;\n                  const subtotal = (productPrice).toFixed(2);\n                  \n                  return (\n                    <tr key={index}>\n                      <td>{productName}</td>\n                      <td>${productPrice.toFixed(2)}</td>\n                      <td>{quantity}</td>\n                      <td>${subtotal}</td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n              <tfoot>\n                <tr>\n                  <td colSpan=\"3\" className=\"total-label\">Total:</td>\n                  <td className=\"total-price\">${totalPrice}</td>\n                </tr>\n              </tfoot>\n            </table>\n            \n           {/* Shipping Information Form */}\n            <div className=\"shipping-form\">\n              <h3>Shipping Information</h3>\n              <div className=\"form-group\">\n                <label htmlFor=\"name\">Full Name:</label>\n                <input \n                  type=\"text\" \n                  id=\"name\" \n                  name=\"name\" \n                  value={shippingInfo.name} \n                  onChange={handleShippingInfoChange}\n                  required\n                />\n              </div>\n              \n              <div className=\"form-group\">\n                <label htmlFor=\"address\">Street Address:</label>\n                <input \n                  type=\"text\" \n                  id=\"address\" \n                  name=\"address\" \n                  value={shippingInfo.address} \n                  onChange={handleShippingInfoChange}\n                  required\n                />\n              </div>\n            </div>\n\n            \n            <div className=\"checkout-actions\">\n              <button \n                className=\"checkout-button\" \n                onClick={handleCheckout} \n                disabled={isProcessing}\n              >\n                {isProcessing ? 'Processing...' : 'Proceed to PayPal'}\n              </button>\n              \n              <button \n                className=\"cancel-button\" \n                onClick={handleCancel} \n                disabled={isProcessing}\n              >\n                Cancel Reservation\n              </button>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n    </>\n  );\n};\n\nexport default Reservations;\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}